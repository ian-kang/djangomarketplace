{% extends 'navbar.html' %}
{% load crispy_forms_tags %}
{% load static %}


<!DOCTYPE html>
<html>
	<head>
		{% block staticfiles %}
		<script src="{% static 'js/account_pull.js' %}"></script>
		{% endblock %}
	</head>
	<body>
		{% block pagecontent %}
		{% block content %}
		    
		    <div class="content-section" style = "padding: 2rem">
		      <div class="media">
		        <div class="media-body">
				  <legend class="border-bottom mb-4">Profile Info</legend>
		          <h2 class="account-heading" id="user"></h2>
		          <p class="text-secondary" id="email"></p>
		        </div>
		      </div>
		      <button class="btn btn-outline-info" onclick="location.href=messageUser()">Message</button>
		      <form method="POST" enctype="multipart/form-data">
		        {% csrf_token %}
		        {% if listings %}
		        <table class="table table-hover">
		          <tr><td>Image</td><td>Item</td><td>Price</td></tr>
		          {% for item in listings %}
		          <tr onclick="location.href='/{{item.acct}}/{{item.listing_id}}'">
		            <td>
		              <img class = "listImage"
		              style="width: 200px; height: 200px;"
		              src="{{item.images.url}}"/></td>
		            <td>{{item.title}}</td>
		            <td>{{item.price}}</td>
		                    
		          </tr>
		          {% endfor %}
		        </table>

		        {% else %}
		        <p>LISTINGS ARE NOT HERE</p>
		        {% endif %}
		    </form>
		    </div>
		    <script>
		      // Gets the user from the url, then displays it on the page
		      // Reasonable assumption about email, since only @virginia.edu is the only one allowed, and computing id is defaulted
		      // Kinda ad hoc-ish, and if you can make a better solution, go for it
		      var full = window.location.href;
		      var split = full.indexOf('/', 9)+1;
		      var account = full.substr(split, full.length).replace('/', '');
		      document.getElementById('user').innerHTML = account;
		      document.getElementById('email').innerHTML = account+"@virginia.edu";      
		    </script>
		{% endblock %}
		{% endblock %}
	</body>
</html>
